<div>
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-slate-900 mb-2">Institution Profile</h1>
    <p class="text-slate-600">Academic settings and requirements for credit-bearing experiential learning.</p>
  </div>

  <!-- Demo Mode Switcher -->
  <div x-show="$store.app.mode === 'demo'" class="mb-6">
    <label class="label">Select Institution</label>
    <div class="flex gap-2">
      <template x-for="inst in $store.app.institutions" :key="inst.id">
        <button
          @click="$store.app.selectedInstitution = inst.id"
          class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
          :class="$store.app.selectedInstitution === inst.id ? 'bg-primary-600 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'"
          x-text="inst.name">
        </button>
      </template>
    </div>
  </div>

  <!-- Custom Mode Template Selector -->
  <div x-show="$store.app.mode === 'custom'" class="mb-6">
    <label class="label">Start from template (optional)</label>
    <div class="flex flex-wrap gap-2">
      <template x-for="inst in $store.app.institutions" :key="inst.id">
        <button
          @click="$store.app.useAsTemplate('institution', inst.id)"
          class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
          :class="$store.app.customInstitution?.name === inst.name
            ? 'bg-primary-600 text-white'
            : 'bg-slate-100 text-slate-700 hover:bg-slate-200'"
          x-text="'Use ' + inst.name">
        </button>
      </template>
      <button
        x-show="$store.app.customInstitution?.name"
        @click="$store.app.resetCustomForm('institution')"
        class="px-4 py-2 rounded-lg text-sm font-medium bg-slate-50 text-slate-500 hover:bg-slate-100 border border-slate-200 transition-colors">
        Clear Form
      </button>
    </div>
  </div>

  <div class="card p-6">
    <!-- Institution Name -->
    <div class="mb-6">
      <label class="label">Institution Name</label>
      <input
        type="text"
        :class="$store.app.mode === 'demo' ? 'input-readonly' : 'input'"
        :readonly="$store.app.mode === 'demo'"
        :value="$store.app.activeInstitution?.name"
        @input="$store.app.mode === 'custom' && ($store.app.customInstitution.name = $event.target.value)">
    </div>

    <!-- Term Settings -->
    <div class="grid sm:grid-cols-3 gap-4 mb-6">
      <div>
        <label class="label">Term Length</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly" readonly
            :value="$store.app.activeInstitution?.termLengthWeeks + ' weeks'">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <div class="flex flex-wrap gap-2">
            <template x-for="weeks in [8, 10, 12, 14, 15, 16]" :key="weeks">
              <button type="button"
                @click="$store.app.customInstitution.termLengthWeeks = weeks"
                class="px-3 py-1.5 rounded-lg text-sm font-medium transition-colors"
                :class="$store.app.customInstitution.termLengthWeeks === weeks
                  ? 'bg-primary-600 text-white'
                  : 'bg-slate-100 text-slate-700 hover:bg-slate-200'"
                x-text="weeks + ' wks'">
              </button>
            </template>
          </div>
        </template>
      </div>
      <div>
        <label class="label">Credit Hours</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly" readonly
            :value="$store.app.activeInstitution?.creditHours + ' credits'">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <div class="flex flex-wrap gap-2">
            <template x-for="credits in [1, 2, 3, 4, 5, 6]" :key="credits">
              <button type="button"
                @click="$store.app.customInstitution.creditHours = credits"
                class="w-10 h-10 rounded-lg text-sm font-medium transition-colors"
                :class="$store.app.customInstitution.creditHours === credits
                  ? 'bg-primary-600 text-white'
                  : 'bg-slate-100 text-slate-700 hover:bg-slate-200'"
                x-text="credits">
              </button>
            </template>
          </div>
        </template>
      </div>
      <div>
        <label class="label">Hours per Week</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly" readonly
            :value="$store.app.activeInstitution?.hoursPerWeek + ' hours'">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <select class="input" x-model.number="$store.app.customInstitution.hoursPerWeek">
            <option value="">Select hours...</option>
            <option value="3">3 hours</option>
            <option value="6">6 hours</option>
            <option value="9">9 hours</option>
            <option value="12">12 hours</option>
            <option value="15">15 hours</option>
            <option value="20">20 hours</option>
          </select>
        </template>
      </div>
    </div>

    <!-- Learner Settings -->
    <div class="grid sm:grid-cols-3 gap-4 mb-6">
      <div>
        <label class="label">Learner Level</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly capitalize" readonly
            :value="$store.app.activeInstitution?.learnerLevel">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <select class="input" x-model="$store.app.customInstitution.learnerLevel">
            <option value="">Select level...</option>
            <option value="undergraduate">Undergraduate</option>
            <option value="graduate">Graduate</option>
          </select>
        </template>
      </div>
      <div>
        <label class="label">Experience Level</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly" readonly
            :value="$store.app.activeInstitution?.experienceLevel">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <select class="input" x-model="$store.app.customInstitution.experienceLevel">
            <option value="">Select prerequisite...</option>
            <option value="Freshman eligible">Freshman eligible</option>
            <option value="Sophomore standing">Sophomore standing</option>
            <option value="Sophomore-Senior standing">Sophomore-Senior standing</option>
            <option value="Junior/Senior standing">Junior/Senior standing</option>
            <option value="Senior standing">Senior standing</option>
            <option value="Graduate level">Graduate level</option>
          </select>
        </template>
      </div>
      <div>
        <label class="label">Assessment Approach</label>
        <template x-if="$store.app.mode === 'demo'">
          <input type="text" class="input-readonly" readonly
            :value="$store.app.activeInstitution?.assessmentApproach">
        </template>
        <template x-if="$store.app.mode === 'custom'">
          <select class="input" x-model="$store.app.customInstitution.assessmentApproach">
            <option value="">Select approach...</option>
            <option value="Letter Grade (A-F)">Letter Grade (A-F)</option>
            <option value="Pass/Fail with Portfolio">Pass/Fail with Portfolio</option>
            <option value="Pass/Fail">Pass/Fail</option>
            <option value="Competency-Based">Competency-Based</option>
          </select>
        </template>
      </div>
    </div>

    <!-- Learning Outcomes -->
    <div class="mb-6">
      <label class="label">Learning Outcomes Required for Credit</label>
      <template x-if="$store.app.mode === 'demo'">
        <textarea rows="5" class="input-readonly" readonly
          x-text="$store.app.activeInstitution?.learningOutcomes?.map((o, i) => (i + 1) + '. ' + o).join('\n')"></textarea>
      </template>
      <template x-if="$store.app.mode === 'custom'">
        <div>
          <textarea rows="5" class="input"
            placeholder="Enter learning outcomes, one per line..."
            x-model="$store.app.learningOutcomesText"
            @blur="$store.app.parseLearningOutcomes()"></textarea>
          <p class="mt-1 text-xs text-slate-500">Enter each outcome on a new line.</p>
        </div>
      </template>
    </div>

    <!-- NACE Competencies -->
    <div>
      <label class="label">Required by FieldWork</label>
      <div class="flex flex-wrap gap-2 mb-4">
        <template x-for="comp in $store.app.framework?.naceCompetencies?.required" :key="comp.id">
          <span class="badge badge-green" x-text="comp.name"></span>
        </template>
      </div>

      <label class="label">Additional Competencies (Selected by Institution)</label>
      <template x-if="$store.app.mode === 'demo'">
        <div class="flex flex-wrap gap-2">
          <template x-for="compId in $store.app.activeInstitution?.additionalNaceCompetencies" :key="compId">
            <span class="badge badge-blue" x-text="$store.app.getNaceCompetencyName(compId)"></span>
          </template>
          <span x-show="!$store.app.activeInstitution?.additionalNaceCompetencies?.length"
            class="text-sm text-slate-400 italic">None selected</span>
        </div>
      </template>
      <template x-if="$store.app.mode === 'custom'">
        <div class="grid sm:grid-cols-2 gap-3">
          <template x-for="comp in $store.app.framework?.naceCompetencies?.optional" :key="comp.id">
            <label class="flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors"
              :class="$store.app.customInstitution?.additionalNaceCompetencies?.includes(comp.id)
                ? 'border-primary-500 bg-primary-50'
                : 'border-slate-200 hover:border-slate-300'">
              <input type="checkbox"
                class="w-4 h-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500"
                :checked="$store.app.customInstitution?.additionalNaceCompetencies?.includes(comp.id)"
                @change="$store.app.toggleNaceCompetency(comp.id)">
              <div>
                <div class="font-medium text-sm" x-text="comp.name"></div>
                <div class="text-xs text-slate-500" x-text="comp.description"></div>
              </div>
            </label>
          </template>
        </div>
      </template>
    </div>
  </div>
</div>
